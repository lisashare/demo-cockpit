<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no,width=device-width">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>快道集团驾驶舱</title>
    <script src="js/rem.js"></script>
    <!-- <link rel="stylesheet" href="https://static.kuaidao.cn/qingteng/wx-css/reset_new.css"> -->
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/demo.css">
    <link rel="stylesheet" href="https://static.kuaidao.cn/qingteng/wx-css/swiper.min.css">
</head>

<body>
    <div id="wrapper" class="wrapper" v-cloak style="display: none;">
        <div class="content">
            <div class="cockpit-header">
                <div class="header-info-left" v-html="time"></div>
                <h2>快道集团驾驶舱</h2>
                <ul class="header-info-right nav-tab">
                    <li class="active" @click="slide(0)"><i></i>商机盒子</li>
                    <li @click="slide(1)">小物种</li>
                    <li style="color: #5A769F;">广州拓展</li>
                </ul>
            </div>
            <div class="swiper-container">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <div class="cockpit-container">
                            <div class="box-left">
                                <div class="left-top">
                                    <h3>12月推广累计（商机盒子+小物种）</h3>
                                    <div class="box gauge-box">
                                        <div class="gauge">
                                            <div>线索会话</div>
                                            <p>2333333</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="left-center">
                                    <h3>12月商务累计</h3>
                                    <div class="pie-charts02">
                                        <div id='echarts_business1' class="echarts_business"></div>
                                        <div id='echarts_business2' class="echarts_business"></div>
                                    </div>
                                </div>
                                <div class="left-bottom">
                                    <h3>12月漏斗图</h3>
                                    <div class="box">
                                        <div id="funnel-charts"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="box-center">
                                <div class="center-top">
                                    <ul>
                                        <li>
                                            <div>今日签约量</div>
                                            <p class="number">{{sign.signNum|formatNumber}}</p>
                                        </li>
                                        <li>
                                            <div>今日签约单量</div>
                                            <p class="number">{{sign.signingNum|formatNumber}}</p>
                                        </li>
                                        <li>
                                            <div>今日签约金额 <i>(元)</i></div>
                                            <p class="number">{{sign.signAmountNum|formatNumber}}</p>
                                        </li>
                                    </ul>
                                </div>
                                <div class="center-center">
                                    <div class="map-box">
                                        <div class="circle-wrap">
                                            <span class="sign-circle">
                                                <i></i>签约量
                                            </span>
                                            <span class="visit-circle">
                                                <i></i>来访量
                                            </span>
                                        </div>
                                        <div id="map-charts"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="box-right">
                                <div class="right-top">
                                    <h3>今日推广统计（商机盒子+小物种）</h3>
                                    <div class="box">
                                        <div id="bar-charts"></div>
                                    </div>
                                </div>
                                <div class="right-center">
                                    <h3>今日电销统计</h3>
                                    <div class="box">
                                        <div id='echarts_tmk' class="echarts_tmk"></div>
                                    </div>
                                </div>
                                <div class="right-bottom">
                                    <h3>今日商务统计</h3>
                                    <div class="box">
                                        <div id="echarts_statistics"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="cockpit-content">
                            <div class="cockpit-left">
                                <div class="pie-charts01">

                                </div>
                                <div class="pie-charts02">

                                </div>
                                <div class="funnel-box box">
                                    <div id="funnel-charts2"></div>
                                </div>
                            </div>
                            <div class="cockpit-center">
                                <div class="map-box">
                                    中国地图
                                    <div id="map-charts2"></div>
                                </div>
                            </div>
                            <div class="cockpit-right">
                                3
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://static.kuaidao.cn/qingteng/wx-js/vue.min.js"></script>
    <script src="https://static.kuaidao.cn/qingteng/wx-js/axios.min.js"></script>
    <script src="https://static.kuaidao.cn/qingteng/wx-js/qs.min.js"></script>
    <script src="https://static.kuaidao.cn/qingteng/wx-js/jquery-1.10.1.min.js"></script>
    <script src="https://cdn.bootcss.com/echarts/4.2.0-rc.2/echarts.min.js"></script>
    <script src="https://static.kuaidao.cn/qingteng/wx-js/swiper.jquery.js"></script>
    <script src="js/map/china.js"></script>
    <script src="json/demo.js"></script>
    <script src="mock/data.js"></script>
    <script src="mock/data2.js"></script>
    <script>
        console.log(DataList)
        var mainVM = new Vue({
            el: '#wrapper',
            data: {
                mySwiper: null,
                mapOption: [],
                mapCharts: null,
                mapOption2: [],
                mapCharts2: null,
                funnelOption: [],
                funnelCharts: null,
                barOption: [],
                barCharts: null,
                // visitData: data.map.visitData,
                // signData: data.map.signData,
                visitData: "",
                signData: "",
                funnelData: data.funnel,
                bar: data.bar,
                sign: data.sign,
                time: "",
                sjTotalData: {
                    totalDayResourceAmount: "10000", // 日资源总量
                    totalDayCallAmount: "10000", // 日通话总量
                    totalDayInvitationAmount: "10000", // 日邀约量

                   	totalDayComeAmount: "10000", // 日来访量
                    totalDaySignAmount: "10000", // 日签约量
                    totalDaySignSingleAmount: "10000", // 日签约单量
                    totalDaySignPrice: "10000", // 日签约金额

                    totalMonthSignSingleAmount: "10000", // 月签约单量
		            totalMonthSignPrice: "10000", // 月签约金额
                }
            },
            filters: {
                formatNumber(value) {
                    var nStr = value;
                    if (!nStr) {return nStr;}
                    nStr += '';
                    x = nStr.split('.');
                    x1 = x[0];
                    // if(!x[1]){
                    //     x[1] = '00';
                    // }  
                    x2 = x.length > 1 ? '.' + x[1] : '';
                    var rgx = /(\d+)(\d{3})/;
                    while (rgx.test(x1)) { x1 = x1.replace(rgx, '$1' + ',' + '$2');}
                    return x1 + x2;
                },
            },
            methods: {
                //分割逗号
                formatNumber(value) {
                    var nStr = value;
                    if (!nStr) {
                        return nStr;
                    }
                    nStr += '';
                    x = nStr.split('.');
                    x1 = x[0];
                    // if(!x[1]){
                    //     x[1] = '00';
                    // }  
                    x2 = x.length > 1 ? '.' + x[1] : '';
                    var rgx = /(\d+)(\d{3})/;
                    while (rgx.test(x1)) {
                        x1 = x1.replace(rgx, '$1' + ',' + '$2');
                    }
                    return x1 + x2;
                },
                //商务统计
                initEchartsByStatistics(daySign,dayCome,daySignSingle,daySignPrice,totalData) {
                    // totalDayComeAmount: "10000", // 日来访量
                    // totalDaySignAmount: "10000", // 日签约量
                    // totalDaySignSingleAmount: "10000", // 日签约单量
                    // totalDaySignPrice: "10000", // 日签约金额
                    var myChart = echarts.init(document.getElementById('echarts_statistics'));
                    option = {
                        radar: {
                            shape: 'circle',
                            radius: '80%',
                            center: ['50%', '48%'],
                            startAngle: 45,
                            // splitNumber: 4,
                            name: {
                                color: '#fff',
                                padding: [0, 20, 0, 20],
                                formatter: function (value, indicator) {
                                    if (value == '签约金额') {
                                        return '{a|' + value + '}{c|(元)}\n{b|' + indicator.num + '}'
                                    } else {
                                        return '{a|' + value + '}\n{b|' + indicator.num + '}'
                                    }
                                },
                                lineHeight: 20,
                                rich: {
                                    a: {
                                        color: '#fff',
                                        fontSize: this.fontSize(0.14),
                                        align: 'center'
                                    },
                                    b: {
                                        color: '#27DBF3',
                                        fontSize: this.fontSize(0.16),
                                        align: 'center'
                                    },
                                    c: {
                                        color: '#fff',
                                        fontSize: this.fontSize(0.10),
                                        padding: [0, 0, 0, 4]
                                    }
                                }
                            },
                            axisLine: {
                                lineStyle: {
                                    width: 2,
                                    color: '#254999',
                                }
                            },
                            splitLine: {
                                show: true,
                                lineStyle: {
                                    width: 2,
                                    type: 'solid',
                                    color: '#254999'
                                },
                            },
                            splitArea: {
                                show: false
                            },
                            indicator: [{
                                    name: '签约量',
                                    max: totalData.totalDaySignAmount,
                                    num: daySign
                                },
                                {
                                    name: '来访量',
                                    max: totalData.totalDayComeAmount,
                                    num: dayCome
                                },
                                {
                                    name: '签约单量',
                                    max: totalData.totalDaySignSingleAmount,
                                    num: daySignSingle
                                },
                                {
                                    name: '签约金额',
                                    max: totalData.totalDaySignPrice,
                                    num: daySignPrice
                                },
                            ],

                        },
                        series: [{
                            name: '认证用户',
                            type: 'radar',
                            data: [{
                                // symbol: icon,
                                symbolSize: 6,
                                value: [daySign, dayCome, daySignSingle, daySignPrice],
                                lineStyle: {
                                    width: 2,
                                    color: new echarts.graphic.LinearGradient(0, 0, 1, 1, [{
                                        offset: 0,
                                        color: '#2AEDFE'
                                    }, {
                                        offset: 1,
                                        color: '#e00d6c'
                                    }])
                                },
                                areaStyle: {
                                    normal: {
                                        color: 'rgba(42, 84, 173, 0.8)'
                                    },
                                }
                            }],
                        }]

                    }
                    myChart.setOption(option);
                },
                //电销统计
                arrayObj(array, key) {
                    var resObj = {};
                    for (var i = 0; i < array.length; i++) {
                        resObj[array[i][key]] = array[i];
                    }
                    return resObj;
                },
                initEchartsByTmk(resource,invitation,call,totalNum) {
                    var _this = this
                    var dataMock = [{
                            name: "资源量",
                            value: resource,
                            radiusArr: ['73.5%', '85%'],
                            color: '#1b6bee',
                            total:totalNum.totalDayResourceAmount

                        },
                        {
                            name: "邀约量",
                            value: invitation,
                            radiusArr: ['53.5%', '65%'],
                            color: '#1bb7c4',
                            total:totalNum.totalDayInvitationAmount
                        },
                        {
                            name: "通话量",
                            value: call,
                            radiusArr: ['33.5%', '45%'],
                            color: '#e530a3',
                            total:totalNum.totalDayCallAmount
                        },

                    ]
                    var dataName = []
                    var myChart = echarts.init(document.getElementById('echarts_tmk'));
                    var dataStyle = {
                        normal: {
                            label: {
                                show: false
                            },
                            labelLine: {
                                show: false
                            },
                            shadowBlur: 40,
                            borderWidth: 10,
                            shadowColor: 'rgba(0, 0, 0, 0)' //边框阴影
                        }
                    };
                    var placeHolderStyle = {
                        normal: {
                            color: '#254999',
                            label: {
                                show: false
                            },
                            labelLine: {
                                show: false
                            }
                        },
                        emphasis: {
                            color: '#254999'
                        }
                    };
                    option = {
                        legend: {
                            // show: true,
                            orient: 'vertical',
                            align: 'left',
                            icon: "circle",
                            top: "center",
                            right: '18%',
                            data: dataMock,
                            padding: [0, 2],
                            itemWidth: 8,
                            formatter: function (name, value) {
                                return "{title|" + name + "}     {value|" + (_this.arrayObj(dataMock,
                                    "name")[name].value) + "}"
                            },

                            textStyle: {
                                rich: {
                                    title: {
                                        fontSize: this.fontSize(0.14),
                                        lineHeight: 15,
                                        color: "rgb(255, 255, 255)"
                                    },
                                    value: {
                                        fontSize: this.fontSize(0.16),
                                        lineHeight: 20,
                                        color: "#27DBF3"
                                    }
                                }
                            },
                        },
                        series: dataMock.map((item, index) => {
                            return {
                                type: 'pie',
                                clockWise: false,
                                radius: item.radiusArr,
                                center: ['30%', '50%'],
                                itemStyle: dataStyle,
                                hoverAnimation: false,
                                startAngle: 90,
                                data: [{
                                        value: item.value,
                                        name: item.name,
                                        itemStyle: {
                                            normal: {
                                                color: item.color,
                                            }
                                        }
                                    },
                                    {
                                        value: item.total - item.value,
                                        name: '',
                                        tooltip: {
                                            show: false
                                        },
                                        itemStyle: placeHolderStyle
                                    },
                                ]
                            }
                        })

                    };
                    myChart.setOption(option);
                },
                fontSize(res) {
                    let docEl = document.documentElement,
                        clientWidth = window.innerWidth || document.documentElement.clientWidth || document.body
                        .clientWidth;
                    if (!clientWidth) return;
                    let fontSize = 100 * (clientWidth / 1920);
                    return res * fontSize;

                },
                //商务累计1
                initEchartsByBusinessOne(jsonData,totalNum) {
                    var myChart = echarts.init(document.getElementById('echarts_business1'));
                    var data2 = [];
                    for (var i = 0; i < 4; i++) {
                        data2.push({
                            value: 80,
                            itemStyle: {
                                normal: {
                                    borderWidth: 1,
                                    /* shadowBlur: 30,*/
                                    borderColor: new echarts.graphic.LinearGradient(0, 0, 1, 1, [{
                                        offset: 0,
                                        color: '#2AEDFE'
                                    }, {
                                        offset: 1,
                                        color: '#2AEDFE'
                                    }]),
                                }
                            }
                        }, {
                            value: 40,
                        });
                    }
                    var seriesObj = [{
                            type: 'pie',
                            radius: ['58%', '70%'],
                            avoidLabelOverlap: false,
                            hoverAnimation: false,
                            label: {
                                normal: {

                                    show: true,
                                    position: 'center'
                                },
                                emphasis: {
                                    show: true,
                                    textStyle: {
                                        fontSize: '30',
                                    }
                                }
                            },
                            labelLine: {
                                normal: {
                                    show: false
                                }
                            },
                            data: [{
                                    value: jsonData,
                                    name: ''
                                },
                                {
                                    value: totalNum.totalMonthSignSingleAmount-jsonData,
                                    name: ''
                                },

                            ]
                        },
                        {
                            name: '',
                            type: 'pie',
                            clockWise: false,
                            radius: ['50%', '50%'],
                            hoverAnimation: false,

                            itemStyle: {
                                normal: {
                                    labelLine: {
                                        show: false
                                    },
                                }
                            },
                            data: data2
                        },

                    ];
                    option = {
                        color: [new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                            offset: 0,
                            color: '#27dbf3'
                        }, {
                            offset: 1,
                            color: '#e00d6c'
                        }]), "#254999"],

                        title: [
                            {
                                text: this.formatNumber(jsonData),
                                textStyle: {
                                    color: '#4effff',
                                    fontSize: this.fontSize(.12),
                                    align: 'center'
                                },
                                x: 'center',
                                y: 'center',
                            },
                            {
                                text: '签约单量',
                                x: 'center',
                                y: 'top',
                                textStyle: {
                                    color: '#fff',
                                    fontSize: this.fontSize(.14),
                                    fontWeight: 'normal'
                                },
                            }
                        ],
                        tooltip: {
                            show: false
                        },
                        legend: {
                            show: false
                        },
                        toolbox: {
                            show: false
                        },
                        series: seriesObj
                    }
                    myChart.setOption(option);
                },
                //商务累计2
                initEchartsByBusinessTwo(jsonData,totalNum) {
                    var myChart = echarts.init(document.getElementById('echarts_business2'));
                    var data2 = [];
                    for (var i = 0; i < 4; i++) {
                        data2.push({
                            value: 80,
                            itemStyle: {
                                normal: {
                                    borderWidth: 1,
                                    /* shadowBlur: 30,*/
                                    borderColor: new echarts.graphic.LinearGradient(0, 0, 1, 1, [{
                                        offset: 0,
                                        color: '#2AEDFE'
                                    }, {
                                        offset: 1,
                                        color: '#2AEDFE'
                                    }]),
                                }
                            }
                        }, {
                            value: 40,
                        });
                    }
                    var seriesObj = [{
                            type: 'pie',
                            radius: ['58%', '70%'],
                            avoidLabelOverlap: false,
                            hoverAnimation: false,
                            label: {
                                normal: {

                                    show: true,
                                    position: 'center'
                                },
                                emphasis: {
                                    show: true,
                                    textStyle: {
                                        fontSize: '30',
                                    }
                                }
                            },
                            labelLine: {
                                normal: {
                                    show: false
                                }
                            },
                            data: [{
                                    value: jsonData,
                                    name: ''
                                },
                                {
                                    value: totalNum.totalMonthSignPrice-jsonData,
                                    name: ''
                                },

                            ]
                        },
                        {
                            name: '',
                            type: 'pie',
                            clockWise: false,
                            radius: ['50%', '50%'],
                            itemStyle: {
                                normal: {
                                    labelLine: {
                                        show: false
                                    },
                                }
                            },
                            data: data2
                        },

                    ];
                    option = {
                        color: [new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                            offset: 0,
                            color: '#0066ff'
                        }, {
                            offset: 1,
                            color: '#e80567 '
                        }]), "#254999"],

                        title: [{
                                text:this.formatNumber(jsonData),
                                textStyle: {
                                    color: '#4effff',
                                    fontSize: this.fontSize(.12),
                                    align: 'center'
                                },
                                x: 'center',
                                y: 'center',
                            },
                            {
                                text: ['{a|签约金额}', '{b|(元)}'].join(''),
                                x: 'center',
                                y: 'top',
                                textStyle: {
                                    color: '#fff',
                                    fontSize: this.fontSize(.14),
                                    rich: {
                                        a: {
                                            color: '#ffffff',
                                            fontSize: this.fontSize(.14),
                                        },
                                        b: {
                                            color: '#fff',
                                            fontSize: this.fontSize(.10),
                                            padding: [0, 0, 0, 4]
                                        }
                                    }

                                }
                            },
                            // {
                            //     text: '(元)',
                            //     x: 'right',
                            //     y: 'top',
                            //     textStyle: {
                            //         color: '#fff',
                            //         fontSize: this.fontSize(.12)
                            //     }
                            // }
                        ],
                        tooltip: {
                            show: false
                        },
                        legend: {
                            show: false
                        },
                        toolbox: {
                            show: false
                        },
                        series: seriesObj
                    }
                    myChart.setOption(option);
                },
                dataFormat() {
                    var time = new Date();
                    return `<span>${time.getFullYear()}</span>年<span>${time.getMonth() + 1 >= 10 ? (time.getMonth() + 1) : '0' + (time.getMonth() + 1)}</span>月<span>${time.getDate() >= 10 ? time.getDate() : '0' + time.getDate()}</span>日 &nbsp;&nbsp;&nbsp;&nbsp;
                            <span>${time.getHours() >= 10 ? time.getHours() : '0' + time.getHours()}</span><i> : </i><span>${time.getMinutes()>=10?time.getMinutes():'0'+time.getMinutes()}</span><i> : </i><span>${time.getSeconds() >= 10 ? time.getSeconds() : '0' + time.getSeconds()}</span>`;
                },
                slide(i) {
                    $('.nav-tab li').removeClass('active').eq(i).addClass('active');
                    this.mySwiper.slideTo(i, 1000, false);
                },
                // 漏斗
                initFunnel() {
                    var _this = this
                    this.funnelCharts = echarts.init(document.getElementById('funnel-charts'));
                    var funnelData = this.funnelData;
                    this.funnelOption = {
                        color: [new echarts.graphic.LinearGradient(0, 0, 1, 0, [{
                            offset: 0,
                            color: '#3ea5f6'
                        }, {
                            offset: 1,
                            color: '#1460ec'
                        }]), new echarts.graphic.LinearGradient(0, 0, 1, 0, [{
                            offset: 0,
                            color: '#29bfc0'
                        }, {
                            offset: 1,
                            color: '#02a9ca'
                        }]), new echarts.graphic.LinearGradient(0, 0, 1, 0, [{
                            offset: 0,
                            color: '#f48266'
                        }, {
                            offset: 1,
                            color: '#e36250'
                        }]), new echarts.graphic.LinearGradient(0, 0, 1, 0, [{
                            offset: 0,
                            color: '#e041ae'
                        }, {
                            offset: 1,
                            color: '#e72a9f'
                        }])],
                        legend: {
                            orient: 'vertical',
                            icon: "circle",
                            top: "center",
                            right: '17%',
                            textStyle: {
                                color: '#27DBF3',
                                fontSize: this.fontSize(0.14),
                            },
                            itemWidth: 8, // 圆圈的宽
                            formatter: function (name) {
                                return "{title|" + name + "}     {value|" + (_this.arrayObj(funnelData,
                                    "name")[name].value) + "}"
                            },
                            data: funnelData
                        },
                        textStyle: {
                            rich: {
                                title: {
                                    fontSize: this.fontSize(0.14),
                                    color: "rgb(255, 255, 255)"
                                },
                                value: {
                                    fontSize: this.fontSize(0.16),
                                    color: "#27DBF3"
                                }
                            }
                        },
                        // calculable: true,
                        series: [{
                            // name:'鼠标移入提示',
                            type: 'funnel',
                            left: '10%',
                            top: "12%",
                            width: '45%',
                            height: '75%',
                            sort: 'descending',
                            gap: 6, // 间隙
                            label: {
                                normal: { // 内部显示
                                    position: 'inside',
                                    formatter: '{d}%',
                                    textStyle: {
                                        color: '#fff'
                                    }
                                },
                            },
                            itemStyle: {
                                normal: {
                                    borderWidth: 0
                                }
                            },
                            data: funnelData
                        }]
                    };
                    this.funnelCharts.setOption(this.funnelOption);
                },
                // 地图
                initMap(param, type) {
                    this.mapCharts = echarts.init(document.getElementById('map-charts'));
                    var planePath =
                        'path://M.6,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705';

                    var convertData = function (data) {
                        if (!data) {
                            return false;
                        }
                        var res = [];
                        for (var i = 0; i < data.length; i++) {
                            var dataItem = data[i];
                            var fromCoord = '';
                            var toCoord = '';
                            if (!type) {
                                fromCoord = geoCoordMap[dataItem[0].name];
                                toCoord = geoCoordMap[dataItem[1].name];
                            } else {
                                fromCoord = geoCoordMap[dataItem[1].name];
                                toCoord = geoCoordMap[dataItem[0].name];
                            }
                            if (fromCoord && toCoord) {
                                res.push([{
                                    coord: fromCoord
                                }, {
                                    coord: toCoord
                                }]);
                            }
                        }
                        return res;
                    };
                    if (type) {
                        var color = "#fae07f";
                    } else {
                        var color = "#27dbf2";
                    }
                    var series = [];
                    // var signItem = [];
                    // for (var key in data) {
                    //     var tmp = [];
                    //     tmp.push(key);
                    //     tmp.push(data[key]);
                    //     signItem.push(tmp);
                    // }
                    console.log(param,1111)
                    param.forEach(function (item, i) {
                        console.log(item)
                        series.push({
                            name: item[0],
                            type: 'lines',
                            zlevel: 1,
                            effect: {
                                show: true,
                                period: 6,
                                trailLength: 0.7,
                                color: '#fff',
                                symbolSize: 3
                            },
                            lineStyle: {
                                normal: {
                                    color: color,
                                    width: 0,
                                    curveness: 0.2
                                }
                            },
                            data: convertData(item[1])
                        }, 
                        { // 固定线条
                            name: item[0],
                            type: 'lines',
                            zlevel: 2,
                            effect: {
                                show: true,
                                period: 6,
                                trailLength: 0,
                                symbol: planePath,
                                symbolSize: 15
                            },
                            lineStyle: {
                                normal: {
                                    color: color,
                                    width: 1,
                                    opacity: 0.4,
                                    curveness: 0.2
                                }
                            },
                            data: convertData(item[1])
                        }, 
                        {
                            name: item[0],
                            type: 'effectScatter',
                            coordinateSystem: 'geo',
                            zlevel: 2,
                            rippleEffect: {
                                brushType: 'stroke'
                            },
                            label: {
                                normal: {
                                    show: true,
                                    position: 'right',
                                    // formatter: '{b}'
                                    formatter: function (params) { // 圆环显示文字
                                        // if(params.data&&params.data.value &&params.data.value.length){
                                            return params.data.name + " " + params.data.value[
                                                params.data.value.length - 1];
                                        // }
                                        // return params.data.name;
                                    },
                                },
                            },
                            symbolSize: function (val) {
                                // return val[2] / 40;
                                return 10;
                            },
                            itemStyle: {
                                normal: {
                                    color: color
                                }
                            },
                            data: item[1].map(function (dataItem) {
                                console.log(dataItem[1])
                                return {
                                    name: dataItem[1].name,
                                    value: geoCoordMap[dataItem[1].name].concat([
                                        dataItem[1].value
                                    ])
                                };
                            })
                        });
                    });

                    this.mapOption = {
                        backgroundColor: 'rgba(255 , 255, 255, 0)',
                        title: {
                            // text: '模拟迁徙',
                            left: 'left',
                            textStyle: {
                                color: '#fff'
                            }
                        },
                        tooltip: {
                            trigger: 'item'
                        },
                        geo: {
                            map: 'china',
                            label: {
                                emphasis: {
                                    show: false
                                }
                            },
                            roam: false, // 是否开启鼠标缩放和平移漫游
                            itemStyle: {
                                normal: {
                                    shadowColor: 'rgba(51, 139, 206, 0.8)',
                                    shadowBlur: 10,
                                    // areaColor: '#203270',
                                    borderColor: '#338bce',
                                    areaColor: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                                        offset: 0,
                                        color: 'rgba(32, 51, 113, 1)'
                                    }, {
                                        offset: 1,
                                        color: 'rgba(51, 80, 176, 0.8)'
                                    }])
                                },
                                emphasis: {
                                    areaColor: '#152350'
                                }
                            }
                        },
                        series: series
                    };
                    this.mapCharts.setOption(this.mapOption);
                },
                initMap2(data, type) {
                    this.mapCharts2 = echarts.init(document.getElementById('map-charts2'));
                    var planePath =
                        'path://M.6,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705';
                    var convertData = function (data) {
                        if (!data) {
                            return false;
                        }
                        var res = [];
                        for (var i = 0; i < data.length; i++) {
                            var dataItem = data[i];
                            var fromCoord, toCoord;
                            if (type) {
                                fromCoord = geoCoordMap[dataItem[0].name];
                                toCoord = geoCoordMap[dataItem[1].name];
                            } else {
                                fromCoord = geoCoordMap[dataItem[1].name];
                                toCoord = geoCoordMap[dataItem[0].name];
                            }
                            if (fromCoord && toCoord) {
                                res.push([{
                                    coord: fromCoord
                                }, {
                                    coord: toCoord
                                }]);
                            }
                        }
                        return res;
                    };
                    if (type) {
                        var color = "#fae07f";
                        // var color = ['#9064fb', '#a48ae3', '#c948ea'];
                    } else {
                        var color = "#27dbf2";
                        // var color = ['#f0ed19', '#edcd2e', '#f2ab12'];
                    }
                    var series = [];
                    var signItem = [];
                    for (var key in this.signData) {
                        var tmp = [];
                        tmp.push(key);
                        tmp.push(this.signData[key]);
                        signItem.push(tmp);
                    }
                    // [['北京', BJData]]
                    signItem.forEach(function (item, i) {
                        series.push({
                            name: item[0],
                            type: 'lines',
                            zlevel: 1,
                            effect: {
                                show: true,
                                period: 6,
                                trailLength: 0.7,
                                color: '#fff',
                                symbolSize: 3
                            },
                            lineStyle: {
                                normal: {
                                    color: color,
                                    width: 0,
                                    curveness: 0.2
                                }
                            },
                            data: convertData(item[1])
                        }, {
                            name: item[0],
                            type: 'lines',
                            zlevel: 2,
                            effect: {
                                show: true,
                                period: 6,
                                trailLength: 0,
                                symbol: planePath,
                                symbolSize: 15 //图标大小
                            },
                            lineStyle: {
                                normal: {
                                    color: color,
                                    width: 1,
                                    opacity: 0.4,
                                    curveness: 0.2
                                }
                            },
                            data: convertData(item[1])
                        }, {
                            name: item[0],
                            type: 'effectScatter',
                            coordinateSystem: 'geo',
                            zlevel: 2,
                            rippleEffect: {
                                brushType: 'stroke'
                            },
                            label: {
                                normal: {
                                    show: true,
                                    position: 'right',
                                    // formatter: '{b}',
                                    formatter: function (params) { // 圆环显示文字
                                        return params.data.name + " " + params.data.value[
                                            params.data.value.length - 1];
                                    },
                                }
                            },
                            symbolSize: function (val) {
                                return val[2] / 8;
                            },
                            itemStyle: {
                                normal: {
                                    color: color
                                }
                            },
                            data: item[1].map(function (dataItem) {
                                return {
                                    name: dataItem[1].name,
                                    value: geoCoordMap[dataItem[1].name].concat([
                                        dataItem[1].value
                                    ])
                                };
                            })
                        });
                    });
                    this.mapOption2 = {
                        backgroundColor: 'rgba(255 , 255, 255, 0)',
                        title: {
                            // text: '模拟迁徙',
                            // left: 'left',
                            // textStyle: {
                            //     color: '#fff'
                            // }
                        },
                        // tooltip: {
                        //     trigger: 'item'
                        // },
                        // legend: {
                        //     // orient: 'vertical',
                        //     top: 'bottom',
                        //     left: 'right',
                        //     data: ['北京', '上海', '广州'],
                        //     textStyle: {
                        //         color: '#fff'
                        //     },
                        //     selectedMode: 'single'
                        // },
                        geo: {
                            map: 'china',
                            label: {
                                emphasis: {
                                    show: false
                                }
                            },
                            roam: false, // 是否开启鼠标缩放和平移漫游
                            itemStyle: {
                                normal: {
                                    areaColor: '#132937',
                                    borderColor: '#0692a4'
                                },
                                emphasis: {
                                    areaColor: '#0b1c2d'
                                }
                            }
                        },
                        series: series
                    };
                    this.mapCharts2.setOption(this.mapOption2);
                },
                initBar() {
                    this.barCharts = echarts.init(document.getElementById('bar-charts'));
                    var data = this.bar;
                    var itemName = [];
                    data.forEach(function (item) {
                        itemName.push(item.name);
                    });
                    this.barOption = {
                        backgroundColor: 'rgba(255 , 255, 255, 0)',
                        xAxis: {
                            type: 'category',
                            axisTick: {
                                show: false
                            },
                            axisLine: {
                                show: false
                            },
                            axisLabel: {
                                show: true,
                                textStyle: {
                                    fontSize: this.fontSize(.14),
                                    color: '#fff',
                                },
                                margin: 20, // 刻度标签与轴线之间的距离。
                            },
                            label: {
                                show: true,
                                position: 'bottom',
                                color: "#fff",
                                formatter: '{b}'
                            },
                            data: itemName,
                        },
                        yAxis: {
                            splitLine: {
                                show: false
                            },
                            axisTick: {
                                show: false
                            },
                            axisLine: {
                                show: false
                            },
                            axisLabel: {
                                show: false
                            }
                        },
                        series: [{
                                // name: '上面圆',
                                type: 'pictorialBar',
                                symbolSize: [30, 15],
                                symbolOffset: [0, -8],
                                z: 5,
                                itemStyle: {
                                    normal: {
                                        color: '#27dbf3'
                                    }
                                },
                                label: {
                                    normal: {
                                        show: true,
                                        position: 'top',
                                        color: '#fff'
                                    }
                                },
                                symbolPosition: 'end',
                                data: data
                            },
                            {
                                // name: '下面圆',
                                type: 'pictorialBar',
                                symbolSize: [30, 15],
                                symbolOffset: [0, 8],
                                z: 1,
                                itemStyle: {
                                    normal: {
                                        color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [{
                                            offset: 0,
                                            color: 'rgba(25,93,223,1)' // 0% 处的颜色
                                        }, {
                                            offset: 1,
                                            color: 'rgba(36,191,238,1)' // 100% 处的颜色
                                        }], false),
                                    }
                                },
                                data: data
                            },
                            {
                                type: 'bar',
                                itemStyle: {
                                    normal: {
                                        color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [{
                                            offset: 0,
                                            color: 'rgba(25,93,223,1)' // 0% 处的颜色
                                        }, {
                                            offset: 1,
                                            color: 'rgba(36,191,238,1)' // 100% 处的颜色
                                        }], false),
                                    }
                                },
                                silent: true,
                                barWidth: 30,
                                barGap: '-100%', // Make series be overlap
                                data: data
                            }
                        ]
                    };
                    this.barCharts.setOption(this.barOption);
                },
                //参数container为图表盒子节点.charts为图表节点
                chartssize(charts, container) {
                    if (!container) {
                        container = charts.
                    }
                    var wi = container.width();
                    var hi = container.height();
                    charts.width(wi)
                    charts.height(hi)
                },
                initSwiper() {
                    this.mySwiper = new Swiper('.swiper-container', {
                        pagination: '.swiper-pagination',
                        observer: true,
                        observeParents: true,
                        effect: 'cube',
                        // cubeEffect: {
                        //     slideShadows: false,
                        //     shadow: false,
                        //     shadowOffset: 100,
                        //     shadowScale: 0.6
                        // },
                        speed: 1000,
                        // loop: false,
                        // autoplay: 3000,
                        onSlideChangeStart: function () {
                            var index = mainVM.mySwiper.activeIndex;
                            $('.nav-tab li').removeClass('active').eq(index).addClass('active');
                        }
                    });
                },
                groupArr(arr){
                    var newArr = [];
                    if(arr != null && arr.length > 0){
                        for(var i=0; i <arr.length; i++){
                            var exist = false;
                            var tempIndex = -1;
                            for(var j=0; j <newArr.length; j++){
                                if(arr[i].startoff === newArr[j][0]){
                                    exist = true;
                                    tempIndex = j;
                                }
                            }
                            // 是否存在同一出发点
                            if(exist){
                                var tempArr = newArr[tempIndex];
                                var obj = [{
                                                name: arr[i].startoff
                                            }, {
                                                name: arr[i].city,
                                                value: arr[i].num
                                        }];
                                tempArr[1].push(obj);
                            } else {
                                var obj = [arr[i].startoff, [
                                        [{
                                        name: arr[i].startoff
                                        }, {
                                        name: arr[i].city,
                                        value: arr[i].num
                                    }]
                                ]];
                                newArr.push(obj);
                            }
                        }
                        return newArr;
                    }
                    return null;
                }
            },
            created() {
                axios({
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    method: 'get',
                    dataType: "json",

                    // url: "http://wd-pre.kuaidaosite.com/app/index.php?i=21&c=entry&do=scanunique&m=kd_tutucha&is_merchan=0",
                    // url: "http://yapi.kuaidaoapp.com/mock/367/kd-mock"
                    url: "http://192.168.8.142:8088/operation/info"
                }).then(function (res) {
                    // console.log('res', res)
                    var res = res.data;
                    var data = JSON.parse(res.msg).DataList;
                    mainVM.signData = mainVM.groupArr(data[0].mapsignamount);
                    mainVM.visitData = mainVM.groupArr(data[0].mapcomevisitamount);
                    mainVM.chartssize($("#map-charts"), $(".map-box"))
                    var num = 0;
                    var arr = [mainVM.signData, mainVM.visitData];
                    mainVM.initMap(arr[num], num);
                }).catch(function (error) {

                })
            },
            mounted() {
                //商机盒子
                document.getElementById('wrapper').style.display = 'block';
                // 当前时间
                this.time = this.dataFormat();
                setInterval(() => {
                    this.time = this.dataFormat();
                }, 1000)

                this.chartssize($("#map-charts"), $(".map-box"))
                this.chartssize($("#map-charts2"), $(".map-box"))
                this.chartssize($("#funnel-charts"))
                this.chartssize($("#bar-charts"))
                this.chartssize($("#echarts_tmk"))
                this.chartssize($("#echarts_statistics"))
                this.initFunnel();
                this.initSwiper();
                this.initBar();
                this.initEchartsByBusinessOne(500,this.sjTotalData)
                this.initEchartsByBusinessTwo(9999.55,this.sjTotalData)
                this.initEchartsByTmk(5000,5000,5000,this.sjTotalData)
                this.initEchartsByStatistics(5000,5000,5000,5000,this.sjTotalData)
                /* 响应式 */
                window.onresize = function () {
                    mainVM.chartssize($("#map-charts"), $(".map-box"))
                    mainVM.chartssize($("#map-charts2"), $(".map-box"))
                    mainVM.chartssize($("#funnel-charts"))
                    mainVM.mapCharts.resize();
                    mainVM.mapCharts2.resize();
                    mainVM.funnelCharts.resize();
                }
                // 地图切换
                // var num = 0;
                // var arr = [this.signData, this.visitData];
                // console.log(this.signData,111)
                // this.initMap(arr[num], num);
                // setInterval(() => {
                //     num = num ? --num : ++num;
                //     this.initMap(arr[num], num);
                // }, 50000)

                // 地图切换
                // var num2 = 0;
                // var arr2 = [this.signData, this.visitData];
                // this.initMap2(arr2[num2], num2);
                // setInterval(() => {
                //     num2 = num2 ? --num2 : ++num2;
                //     this.initMap2(arr2[num2], num2);
                // }, 50000)
                // setInterval(()=>{ // 整体数据请求;
                // },4000)
            },
        })
    </script>
</body>

</html>